<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>手機題詞器</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: Arial, sans-serif;
        }

        #controls {
            padding: 10px;
            background-color: #f0f0f0;
        }

        #controls label {
            display: block;
            margin-top: 10px;
            font-size: 14px;
            color: #333;
        }

        #controls input, #controls select, #controls button, #controls textarea {
            width: 100%;
            margin-top: 5px;
            padding: 8px;
            font-size: 14px;
        }

        #inputText {
            height: 150px;
            resize: vertical;
            width: 100%;
            padding: 10px;
            font-size: 16px;
            box-sizing: border-box;
            border-radius: 5px;
            border: 1px solid #ccc;
        }

        #fontSettings {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        #fontSettings label {
            margin: 0;
        }

        #controls input[type="color"] {
            width: 50px;
            height: 30px;
            padding: 0;
            margin-right: 5px;
        }

        #controls input[type="number"] {
            width: 80px;
            padding: 5px;
        }

        #controls select {
            width: auto;
            padding: 5px;
        }

        #controls button {
            padding: 10px;
            font-size: 16px;
            background-color: #007bff;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        #controls button:hover {
            background-color: #0056b3;
        }

        #mirror {
            display: none;
        }

        /* 按鈕未選中時的樣式 */
        #controls label[for="mirror"] {
            display: inline-block;
            padding: 10px 20px;
            background-color: #ccc;
            color: #000;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            text-align: center;
        }

        /* 按鈕選中時的樣式 */
        #mirror:checked + label {
            background-color: #007bff;
            color: #fff;
        }
#lineSettings {
    align-items: center;
    gap: 10px; /* 控制項目之間的間距 */
}


        #display {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: #000;
            color: #fff;
            font-size: 50px;
            display: none;
            justify-content: flex-start;
            align-items: flex-start;
            text-align: center;
        }

        #display.mirror {
            transform: scaleX(-1);
        }

        #textContainer {
            display: block;
        }

        #text {
            white-space: pre-wrap;
            line-height: 1.5;
            direction: ltr;
        }

        #lineThicknessOptions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .lineOption {
            width: 40px;
            height: 20px;
            background-color: red;
            cursor: pointer;
            border-radius: 5px;
        }

        .lineOption[data-width="1"] { height: 1px; }
        .lineOption[data-width="2"] { height: 2px; }
        .lineOption[data-width="3"] { height: 3px; }
        .lineOption[data-width="4"] { height: 4px; }
        .lineOption[data-width="5"] { height: 5px; }
        .lineOption[data-width="6"] { height: 6px; }
        .lineOption[data-width="7"] { height: 7px; }

        .lineOption.selected {
            border: 2px solid blue;
        }

        #controlButtons {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: none;
            gap: 20px;
        }

        #controlButtons button {
            padding: 10px 20px;
            font-size: 16px;
        }
#speedSetting {
    display: inline-flex;
    align-items: center;
    gap: 5px; /* 控制文字和輸入框之間的距離 */
}

#referenceLine {
    position: absolute;
    top: 50%; /* 固定在畫面中間 */
    left: 0;
    width: 100%;
    border-top: 2px solid red; /* 確保這裡有適當的 border 設置 */
    pointer-events: none; /* 防止參考線阻擋點擊事件 */
}
    </style>
</head>
<body>

<div id="controls">
    <label for="inputText">輸入文字：</label>
    <textarea id="inputText">這是一個簡單的題詞器。</textarea>

<div id="controls">
    <label for="fontFamily">選擇字體：</label>
    <select id="fontFamily">
        <option value="Arial, sans-serif">Arial</option>
        <option value="'微軟正黑體', sans-serif">微軟正黑體</option>
        <option value="'Times New Roman', serif">Times New Roman</option>
        <option value="'Courier New', monospace">Courier New</option>
    </select>
    <input type="checkbox" id="mirror">
    <label for="mirror">鏡像文字</label>

    <label for="fontSize">字體大小：</label>
    <input type="number" id="fontSize" value="40" min="10" max="100">

    <label for="speed">滾動速度：</label>
    <input type="number" id="speed" value="30" min="10" max="100"> px/s
</div>

<div id="lineSettings">
    <label for="fontColor">字體顏色：</label>
    <input type="color" id="fontColor" value="#FFFFFF">

    <label for="bgColor">背景顏色：</label>
    <input type="color" id="bgColor" value="#000000">

    <label for="refLineColor">參考線顏色：</label>
    <input type="color" id="refLineColor" value="#FF0000">
    <label for="refLineWidth">參考線粗細：
    <select id="refLineWidth">
        <option value="1">1px</option>
        <option value="2">2px</option>
        <option value="3">3px</option>
        <option value="4">4px</option>
        <option value="5">5px</option>
        <option value="6">6px</option>
        <option value="7">7px</option>
    </select></label>

</div>


    <button id="startBtn">開始滾動</button>

</div>

<div id="display">
    <div id="textContainer">
        <div id="text"></div>
    </div>
    <div id="referenceLine"></div>
</div>

<div id="controlButtons">
    <button id="pauseBtn">暫停</button>
    <button id="exitBtn">退出全屏</button>
</div>

<script>
    const inputText = document.getElementById('inputText');
    const fontFamily = document.getElementById('fontFamily');
    const bgColor = document.getElementById('bgColor');
    const fontColor = document.getElementById('fontColor');
    const fontSize = document.getElementById('fontSize');
    const speed = document.getElementById('speed');
    const mirror = document.getElementById('mirror');
    const refLineColor = document.getElementById('refLineColor');
    const lineOptions = document.querySelectorAll('.lineOption');
    const startBtn = document.getElementById('startBtn');
    const display = document.getElementById('display');
    const textContainer = document.getElementById('textContainer');
    const text = document.getElementById('text');
    const referenceLine = document.getElementById('referenceLine');
    const pauseBtn = document.getElementById('pauseBtn');
    const exitBtn = document.getElementById('exitBtn');
    const controlButtons = document.getElementById('controlButtons');

    let animationFrame;
    let isPaused = false;
    let isDragging = false;
    let dragStartY = 0;
    let dragStartTranslateY = 0;
    let currentSpeed;
    let startPosition;
    let currentTranslateY;
    let lastTimestamp;

    startBtn.addEventListener('click', () => {
        // 設置文本樣式和內容
        text.style.fontFamily = fontFamily.value;
        text.style.fontSize = fontSize.value + 'px';
        text.style.color = fontColor.value;
        text.innerText = inputText.value;
        display.style.backgroundColor = bgColor.value;

        // 設置鏡像效果
        if (mirror.checked) {
            display.classList.add('mirror');
            textContainer.classList.add('mirror');
        } else {
            display.classList.remove('mirror');
            textContainer.classList.remove('mirror');
        }

        // 設置參考線樣式
        referenceLine.style.borderTopColor = refLineColor.value;

// 在變數區域定義後添加此代碼
refLineWidth.addEventListener('change', () => {
    referenceLine.style.borderTopWidth = `${refLineWidth.value}px`; // 更新參考線的粗細
});

        // 獲取選擇的參考線粗細
        let selectedLineWidth = 2; // 默認粗細
        lineOptions.forEach(option => {
            option.addEventListener('click', function() {
                selectedLineWidth = this.getAttribute('data-width');
                referenceLine.style.borderTopWidth = `${selectedLineWidth}px`;
                // 標記選中的樣式
                lineOptions.forEach(opt => opt.classList.remove('selected'));
                this.classList.add('selected');
            });
        });


        // 顯示題詞器
        display.style.display = 'flex';
        controlButtons.style.display = 'flex';
        document.getElementById('controls').style.display = 'none';

        // 進入全螢幕模式
        enterFullScreen();

        // 初始化滾動參數
        isPaused = false;
        isDragging = false;
        currentSpeed = parseInt(speed.value);

        setTimeout(() => {
            const displayHeight = display.offsetHeight;
            const referenceLinePosition = displayHeight * 0.5; // 參考線位置

            startPosition = referenceLinePosition; // 從參考線位置開始
            currentTranslateY = startPosition;
            text.style.transform = `translateY(${currentTranslateY}px)`;

            lastTimestamp = performance.now();

            // 開始滾動
            requestAnimationFrame(scrollText);
        }, 0);
    });

    function scrollText(timestamp) {
        if (isPaused || isDragging) {
            lastTimestamp = timestamp;
            animationFrame = requestAnimationFrame(scrollText);
            return;
        }

        const deltaTime = timestamp - lastTimestamp;
        lastTimestamp = timestamp;

        const distance = deltaTime * currentSpeed / 1000;
        currentTranslateY -= distance;
        text.style.transform = `translateY(${currentTranslateY}px)`;

        if (currentTranslateY + text.offsetHeight > 0) {
            animationFrame = requestAnimationFrame(scrollText);
        } else {
            exitFullScreen();
        }
    }

    pauseBtn.addEventListener('click', () => {
        if (!isPaused) {
            isPaused = true;
            pauseBtn.textContent = '繼續';
        } else {
            isPaused = false;
            pauseBtn.textContent = '暫停';
            lastTimestamp = performance.now();
        }
    });

    exitBtn.addEventListener('click', () => {
        cancelAnimationFrame(animationFrame);
        exitFullScreen();
    });

    display.addEventListener('click', () => {
        if (isDragging) return;
        if (!isPaused) {
            isPaused = true;
            pauseBtn.textContent = '繼續';
        } else {
            isPaused = false;
            pauseBtn.textContent = '暫停';
            lastTimestamp = performance.now();
        }
    });

    function onDragStart(event) {
        if (!isPaused) return;
        isDragging = true;
        dragStartY = event.type === 'mousedown' ? event.clientY : event.touches[0].clientY;
        const style = window.getComputedStyle(text);
        const matrix = new DOMMatrixReadOnly(style.transform);
        dragStartTranslateY = matrix.m42;
        event.preventDefault();
        document.body.style.userSelect = 'none';
    }

    function onDragMove(event) {
        if (!isDragging) return;
        const currentY = event.type === 'mousemove' ? event.clientY : event.touches[0].clientY;
        const deltaY = currentY - dragStartY;
        const newTranslateY = dragStartTranslateY + deltaY;
        text.style.transform = `translateY(${newTranslateY}px)`;
    }

    function onDragEnd(event) {
        if (!isDragging) return;
        isDragging = false;
        const style = window.getComputedStyle(text);
        const matrix = new DOMMatrixReadOnly(style.transform);
        currentTranslateY = matrix.m42;
        document.body.style.userSelect = 'auto';
    }

    text.addEventListener('mousedown', onDragStart);
    document.addEventListener('mousemove', onDragMove);
    document.addEventListener('mouseup', onDragEnd);

    text.addEventListener('touchstart', onDragStart);
    document.addEventListener('touchmove', onDragMove);
    document.addEventListener('touchend', onDragEnd);

    function enterFullScreen() {
        const docElm = document.documentElement;
        if (docElm.requestFullscreen) {
            docElm.requestFullscreen();
        } else if (docElm.mozRequestFullScreen) {
            docElm.mozRequestFullScreen();
        } else if (docElm.webkitRequestFullscreen) {
            docElm.webkitRequestFullscreen();
        } else if (docElm.msRequestFullscreen) {
            docElm.msRequestFullscreen();
        }
    }

    function exitFullScreen() {
        if (document.exitFullscreen) {
            document.exitFullscreen();
        } else if (document.mozCancelFullScreen) {
            document.mozCancelFullScreen();
        } else if (document.webkitExitFullscreen) {
            document.webkitExitFullscreen();
        } else if (document.msExitFullscreen) {
            document.msExitFullscreen();
        }
        display.style.display = 'none';
        controlButtons.style.display = 'none';
        document.getElementById('controls').style.display = 'block';
        cancelAnimationFrame(animationFrame);
    }

    document.addEventListener('keydown', (event) => {
        switch (event.code) {
            case 'Space':
                if (!isPaused) {
                    isPaused = true;
                    pauseBtn.textContent = '繼續';
                } else {
                    isPaused = false;
                    pauseBtn.textContent = '暫停';
                    lastTimestamp = performance.now();
                }
                break;
            case 'ArrowUp':
                currentTranslateY -= 20;
                text.style.transform = `translateY(${currentTranslateY}px)`;
                break;
            case 'ArrowDown':
                currentTranslateY += 20;
                text.style.transform = `translateY(${currentTranslateY}px)`;
                break;
            case 'Escape':
                exitFullScreen();
                break;
            default:
                break;
        }
    });
</script>

</body>
</html>
