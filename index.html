<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <link rel='manifest' href='./manifest.json'>
    <link href="/teleprompter/favicon.ico" rel="Shortcut Icon" type="image/x-icon"/>
    <link href="/teleprompter/favicon.ico" rel="Bookmark" type="image/x-icon"/>
    <link rel="apple-touch-icon" href="/teleprompter/apple-touch-icon.png">
    <meta charset="UTF-8">
    <title>簡易提詞器</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: Arial, sans-serif;
        }

        #controls {
            padding: 10px;
            background-color: #f0f0f0;
        }

        #controls label {
            display: block;
            margin-top: 10px;
            font-size: 14px;
            color: #333;
        }

        #controls input, #controls select, #controls button, #controls textarea {
            width: 100%;
            margin-top: 5px;
            padding: 8px;
            font-size: 14px;
        }

        #inputText {
            height: 150px;
            resize: vertical;
            width: 100%;
            padding: 10px;
            font-size: 16px;
            box-sizing: border-box;
            border-radius: 5px;
            border: 1px solid #ccc;
        }

        #fontSettings {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        #fontSettings label {
            margin: 0;
        }

        #controls input[type="color"] {
            width: 50px;
            height: 30px;
            padding: 0;
            margin-right: 5px;
        }

        #controls input[type="number"] {
            width: 80px;
            padding: 5px;
        }

        #controls select {
            width: auto;
            padding: 5px;
        }

        #controls button {
            padding: 10px;
            font-size: 16px;
            background-color: #007bff;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        #controls button:hover {
            background-color: #0056b3;
        }

        #mirror {
            display: none;
        }

        /* 按鈕未選中時的樣式 */
        #controls label[for="mirror"] {
            display: inline-block;
            padding: 10px 20px;
            background-color: #ccc;
            color: #000;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            text-align: center;
        }

        /* 按鈕選中時的樣式 */
        #mirror:checked + label {
            background-color: #007bff;
            color: #fff;
        }
#lineSettings {
    align-items: center;
    gap: 10px; /* 控制項目之間的間距 */
}


#display {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
    background-color: #000;
    color: #fff;
    font-size: 50px;
    display: none;
    justify-content: flex-start;
    align-items: flex-start;
}

        #display.mirror {
            transform: scaleX(-1);
        }

#textContainer {
    width: 100%;
    display: block;
}

#text {
    width: 100%; /* 確保文字容器占滿寬度 */
    text-align: center; /* 將文字居中顯示 */
    white-space: pre-wrap;
    line-height: 1.5;
    direction: ltr;
}

        #lineThicknessOptions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .lineOption {
            width: 40px;
            height: 20px;
            background-color: red;
            cursor: pointer;
            border-radius: 5px;
        }

        .lineOption[data-width="1"] { height: 1px; }
        .lineOption[data-width="2"] { height: 2px; }
        .lineOption[data-width="3"] { height: 3px; }
        .lineOption[data-width="4"] { height: 4px; }
        .lineOption[data-width="5"] { height: 5px; }
        .lineOption[data-width="6"] { height: 6px; }
        .lineOption[data-width="7"] { height: 7px; }

        .lineOption.selected {
            border: 2px solid blue;
        }

        #controlButtons {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: none;
            gap: 20px;
        }

        #controlButtons button {
            padding: 10px 20px;
            font-size: 16px;
        }
#speedSetting {
    display: inline-flex;
    align-items: center;
    gap: 5px; /* 控制文字和輸入框之間的距離 */
}

#referenceLine {
    position: absolute;
    top: 50%; /* 固定在畫面中間 */
    left: 0;
    width: 100%;
    border-top: 2px solid red; /* 確保這裡有適當的 border 設置 */
    pointer-events: none; /* 防止參考線阻擋點擊事件 */
}
    </style>
</head>
<body>

<h1 style="text-align: center; font-size: 36px; font-weight: bold; 
    background-color: #FFFACD; /* 設置背景色 */
    color: black;              /* 設置文字顏色 */
    padding: 20px;             /* 增加內部間距 */
    margin: 20px 0;            /* 增加外部間距 */
    border-radius: 10px;       /* 設置圓角效果 */
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* 添加陰影效果 */
">
    簡易提詞器
</h1>
<p style="text-align: center;">
    ver.2024/09/17 程式維護：<a href="https://www.facebook.com/profile.php?id=61557246475372" target="_blank">仨寶爸中醫博士吳啓銘</a>
</p>

<div id="controls">

<textarea id="inputText" placeholder="在文本框中輸入要滾動的文字，點擊「開始滾動」按鈕即可開始顯示提詞。" oninput="this.placeholder = ''"></textarea>

<div id="controls">
<button id="startBtn">開始滾動</button>

<label for="fontFamily">選擇字體：
    <select id="fontFamily">
        <option value="'PingFang TC', 'Microsoft JhengHei', sans-serif">微軟正黑體</option>
        <option value="'Noto Serif CJK TC', 'Source Han Serif', serif">思源宋體</option>
        <option value="'DFKai-SB', 'KaiTi', serif">標楷體</option>
        <option value="Arial, sans-serif">Arial</option>
        <option value="'Times New Roman', serif">Times New Roman</option>
        <option value="'Courier New', monospace">Courier New</option>
    </select> 

   <input type="checkbox" id="mirror">
    <label for="mirror">鏡像文字</label>

    <label for="fontSize">字體大小：
    <input type="number" id="fontSize" value="40" min="10" max="100"></label>

    <label for="speed">滾動速度：
    <input type="number" id="speed" value="30" min="10" max="100"> px/s</label>
</div>

<div id="lineSettings">
    <label for="fontColor">字體顏色：
    <input type="color" id="fontColor" value="#FFFFFF"></label>

    <label for="bgColor">背景顏色：
    <input type="color" id="bgColor" value="#000000"></label>

    <label for="refLineColor">參考線顏色：
    <input type="color" id="refLineColor" value="#FF0000"></label>
    <label for="refLineWidth">參考線粗細：
    <select id="refLineWidth">
        <option value="1">1px</option>
        <option value="2">2px</option>
        <option value="3" selected>3px</option> <!-- 設置預設值為 3px -->        
        <option value="4">4px</option>
        <option value="5">5px</option>
        <option value="6">6px</option>
        <option value="7">7px</option>
    </select></label>

</div>


</div>

<div id="display">
    <div id="textContainer">
        <div id="text"></div>
    </div>
    <div id="referenceLine"></div>
</div>

<div id="controlButtons">
    <button id="pauseBtn">暫停</button>
    <button id="exitBtn">退出全屏</button>
</div>

<script>
// 取得DOM元素的參考
const inputText = document.getElementById('inputText');
const fontFamily = document.getElementById('fontFamily');
const bgColor = document.getElementById('bgColor');
const fontColor = document.getElementById('fontColor');
const fontSize = document.getElementById('fontSize');
const speed = document.getElementById('speed');
const mirror = document.getElementById('mirror');
const refLineColor = document.getElementById('refLineColor');
const refLineWidth = document.getElementById('refLineWidth');
const startBtn = document.getElementById('startBtn');
const display = document.getElementById('display');
const textContainer = document.getElementById('textContainer');
const text = document.getElementById('text');
const referenceLine = document.getElementById('referenceLine');
const pauseBtn = document.getElementById('pauseBtn');
const exitBtn = document.getElementById('exitBtn');
const controlButtons = document.getElementById('controlButtons');

// 狀態與控制變數
let animationFrame;
let isPaused = false;  // 判斷是否暫停
let isDragging = false; // 判斷是否在拖動
let dragStartY = 0; // 拖動開始時的Y座標
let dragStartTranslateY = 0; // 拖動開始時的文字Y偏移量
let currentSpeed; // 滾動速度
let startPosition; // 初始滾動位置
let currentTranslateY; // 目前的Y偏移量
let lastTimestamp; // 上次動畫幀的時間

// 開始滾動按鈕點擊事件處理
startBtn.addEventListener('click', () => {
    // 設置文本樣式和內容
    text.style.fontFamily = fontFamily.value;
    text.style.fontSize = fontSize.value + 'px';
    text.style.color = fontColor.value;
    text.innerText = inputText.value;
    display.style.backgroundColor = bgColor.value;

    // 設置鏡像效果
    if (mirror.checked) {
        display.classList.add('mirror');        // 如果選中，則添加鏡像類別
        textContainer.classList.add('mirror');
    } else {
        display.classList.remove('mirror');     // 否則移除鏡像類別
        textContainer.classList.remove('mirror');
    }

    // 設置參考線樣式
    referenceLine.style.borderTopColor = refLineColor.value;
    referenceLine.style.borderTopWidth = `${refLineWidth.value}px`; // 立即設置參考線粗細

    // 動態更新參考線粗細
    refLineWidth.addEventListener('change', () => {
        referenceLine.style.borderTopWidth = `${refLineWidth.value}px`;
    });

    // 顯示題詞器
    display.style.display = 'flex';
    controlButtons.style.display = 'flex';
    document.getElementById('controls').style.display = 'none';

    // 進入全螢幕模式
    enterFullScreen();

    // 強制 iOS 渲染重繪，避免滾動問題
    text.style.transform = 'translateY(0px)';
    void text.offsetHeight;

    // 初始化滾動參數
    isPaused = false;
    isDragging = false;
    currentSpeed = parseInt(speed.value);

    setTimeout(() => {
        const displayHeight = display.offsetHeight;
        const referenceLinePosition = displayHeight * 0.5;

        startPosition = referenceLinePosition;
        currentTranslateY = startPosition;
        text.style.transform = `translateY(${currentTranslateY}px)`;

        lastTimestamp = performance.now();

        requestAnimationFrame(scrollText);
    }, 100);
});

// 處理滾動文字的函數
function scrollText(timestamp) {
    // 如果處於暫停或拖動狀態，則停止滾動
    if (isPaused || isDragging) {
        lastTimestamp = timestamp;
        animationFrame = requestAnimationFrame(scrollText);
        return;
    }

    // 計算經過的時間
    const deltaTime = timestamp - lastTimestamp;
    lastTimestamp = timestamp;

    // 根據滾動速度計算移動的距離
    const distance = deltaTime * currentSpeed / 1000;
    currentTranslateY -= distance; // 讓文字向上滾動
    text.style.transform = `translateY(${currentTranslateY}px)`; // 更新位置

    // 如果還有文字未滾完，繼續滾動，否則退出全螢幕
    if (currentTranslateY + text.offsetHeight > 0) {
        animationFrame = requestAnimationFrame(scrollText);
    } else {
        exitFullScreen();
    }
}

// 暫停/繼續滾動按鈕事件
pauseBtn.addEventListener('click', () => {
    if (!isPaused) {
        isPaused = true;
        pauseBtn.textContent = '繼續'; // 更新按鈕文字
    } else {
        isPaused = false;
        pauseBtn.textContent = '暫停'; // 更新按鈕文字
        lastTimestamp = performance.now(); // 更新時間戳
    }
});

// 退出按鈕事件
exitBtn.addEventListener('click', () => {
    cancelAnimationFrame(animationFrame); // 停止動畫幀
    exitFullScreen(); // 退出全螢幕
});

// 點擊顯示區域來暫停/繼續滾動
display.addEventListener('click', () => {
    if (isDragging) return; // 如果正在拖動，忽略點擊
    if (!isPaused) {
        isPaused = true;
        pauseBtn.textContent = '繼續';
    } else {
        isPaused = false;
        pauseBtn.textContent = '暫停';
        lastTimestamp = performance.now(); // 更新時間戳
    }
});

// 處理拖動事件的起始
function onDragStart(event) {
    if (!isPaused) return; // 只有在暫停狀態下才能拖動
    isDragging = true; // 開始拖動
    dragStartY = event.type === 'mousedown' ? event.clientY : event.touches[0].clientY; // 記錄拖動起始點
    const style = window.getComputedStyle(text);
    const matrix = new DOMMatrixReadOnly(style.transform);
    dragStartTranslateY = matrix.m42; // 記錄拖動起始時的Y偏移量
    event.preventDefault(); // 防止預設行為
    document.body.style.userSelect = 'none'; // 禁止選中文字
}

// 處理拖動過程
function onDragMove(event) {
    if (!isDragging) return; // 如果未拖動，返回
    const currentY = event.type === 'mousemove' ? event.clientY : event.touches[0].clientY; // 當前拖動位置
    const deltaY = currentY - dragStartY; // 計算拖動距離
    const newTranslateY = dragStartTranslateY + deltaY; // 更新Y偏移量
    text.style.transform = `translateY(${newTranslateY}px)`; // 更新文字位置
}

// 結束拖動
function onDragEnd(event) {
    if (!isDragging) return;
    isDragging = false;
    const style = window.getComputedStyle(text);
    const matrix = new DOMMatrixReadOnly(style.transform);
    currentTranslateY = matrix.m42; // 記錄最終Y偏移量
    document.body.style.userSelect = 'auto'; // 恢復選中文字功能
}

// 添加拖動事件監聽器
text.addEventListener('mousedown', onDragStart);
document.addEventListener('mousemove', onDragMove);
document.addEventListener('mouseup', onDragEnd);

text.addEventListener('touchstart', onDragStart);
document.addEventListener('touchmove', onDragMove);
document.addEventListener('touchend', onDragEnd);

// 進入全螢幕模式
function enterFullScreen() {
    const docElm = document.documentElement;
    if (docElm.requestFullscreen) {
        docElm.requestFullscreen();
    } else if (docElm.mozRequestFullScreen) {
        docElm.mozRequestFullScreen();
    } else if (docElm.webkitRequestFullscreen) {
        docElm.webkitRequestFullscreen();
    } else if (docElm.msRequestFullscreen) {
        docElm.msRequestFullscreen();
    }
}

// 退出全螢幕模式
function exitFullScreen() {
    if (document.exitFullscreen) {
        document.exitFullscreen();
    } else if (document.mozCancelFullScreen) {
        document.mozCancelFullScreen();
    } else if (document.webkitExitFullscreen) {
        document.webkitExitFullscreen();
    } else if (document.msExitFullscreen) {
        document.msExitFullscreen();
    }
    display.style.display = 'none';
    controlButtons.style.display = 'none';
    document.getElementById('controls').style.display = 'block';
    cancelAnimationFrame(animationFrame); // 停止動畫
}

// 處理鍵盤事件
document.addEventListener('keydown', (event) => {
    switch (event.code) {
        case 'Space':
            // 暫停/繼續滾動
            if (!isPaused) {
                isPaused = true;
                pauseBtn.textContent = '繼續';
            } else {
                isPaused = false;
                pauseBtn.textContent = '暫停';
                lastTimestamp = performance.now();
            }
            break;
        case 'ArrowUp':
            // 向上滾動
            currentTranslateY -= 20;
            text.style.transform = `translateY(${currentTranslateY}px)`;
            break;
        case 'ArrowDown':
            // 向下滾動
            currentTranslateY += 20;
            text.style.transform = `translateY(${currentTranslateY}px)`;
            break;
        case 'Escape':
            // 退出全螢幕
            exitFullScreen();
            break;
        default:
            break;
    }
});


</script>

</body>
</html>
