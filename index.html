<!DOCTYPE html>
<html lang="zh-TW">
<head>
<!-- Open Graph meta tags -->
    <meta property="og:title" content="簡易提詞器">
    <meta property="og:description" content="這是一個簡易的提詞機網頁">
    <meta property="og:image" content="https://chimungwu.github.io/teleprompter/Icon.png">
    <meta property="og:url" content="https://chimungwu.github.io/teleprompter/">
    <meta property="og:type" content="website">
    <link rel='manifest' href='./manifest.json'>
    <link rel="icon" href="/teleprompter/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" href="/teleprompter/apple-touch-icon.png">
    <meta charset="UTF-8">
    <title>簡易提詞器</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- iOS 状态栏背景颜色 -->
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<!-- Android 状态栏背景颜色 -->
    <meta name="theme-color" content="#000000">
<!-- 引入字体 -->
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@500&family=Noto+Serif+TC&display=swap" rel="stylesheet">

    <style>
    /* 基本字體設定 */
    body {
        font-family: 'Noto Sans TC', 'PingFang TC', 'Microsoft JhengHei', 'Heiti TC', 'WenQuanYi Micro Hei', sans-serif;
    }

    /* 衬线字體設定 */
    .serif {
        font-family: 'Noto Serif TC', 'Songti TC', 'PMingLiU', 'Times New Roman', serif;
    }

    /* 楷體字體設定 */
    .kai {
        font-family: 'BiauKai', 'STKaiti', 'KaiTi', 'DFKai-SB', 'Kai', 'KaiTi TC', 'Noto Serif TC', serif;
    }

    body, html {
        margin: 0;
        padding: 0;
        height: 100%;
        background-color: #000000; /* 設定全域背景色 */
    }

    #controls {
        padding: 10px;
        background-color: #f0f0f0;
    }

    #controls label {
        display: block;
        margin-top: 10px;
        font-size: 14px;
        color: #333;
    }

    #controls input, #controls select, #controls button, #controls textarea {
        width: 100%;
        margin-top: 5px;
        padding: 8px;
        font-size: 14px;
    }

    #inputText {
        height: 150px;
        resize: vertical;
        width: 100%;
        padding: 10px;
        font-size: 16px;
        box-sizing: border-box;
        border-radius: 5px;
        border: 1px solid #ccc;
    }

#buttonContainer {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 10px;
    max-width: 600px;
    margin: 0 auto;
    padding: 10px;
}

#buttonContainer button,
#controls label[for="mirror"],
#controls label[for="showTimer"] {
    flex: 1 1 calc(50% - 10px);
    min-width: 120px;
    max-width: calc(50% - 10px);
    box-sizing: border-box;
    padding: 12px 15px;
    font-size: 16px;
    font-family: Arial, sans-serif;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    text-align: center;
    transition: all 0.3s ease;
    outline: none;
    font-weight: normal;
}

/* 開始滾動按鈕樣式 */
#buttonContainer button:nth-child(1) {
    background-color: #007bff;
    color: #fff;
}

#buttonContainer button:nth-child(1):hover {
    background-color: #0056b3;
}

/* 清除暫存按鈕樣式 */
#buttonContainer button:nth-child(2) {
    background-color: #e9ecef;
    color: #495057;
    border: 1px solid #ced4da;
}

#buttonContainer button:nth-child(2):hover {
    background-color: #e2e6ea;
}

/* 切換按鈕樣式 */
#controls label[for="mirror"],
#controls label[for="showTimer"] {
    background-color: #e9ecef;
    color: #495057;
    border: 1px solid #ced4da;
}

#mirror:checked + label[for="mirror"],
#showTimer:checked + label[for="showTimer"] {
    background-color: #28a745;
    color: #fff;
    border-color: #28a745;
}

/* 共用的懸停效果 */
#buttonContainer button:hover,
#controls label[for="mirror"]:hover,
#controls label[for="showTimer"]:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

/* 共用的點擊效果 */
#buttonContainer button:active,
#controls label[for="mirror"]:active,
#controls label[for="showTimer"]:active {
    transform: translateY(1px);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

/* 隱藏實際的複選框 */
#mirror, #showTimer {
    display: none;
}

/* 響應式設計 */
@media (max-width: 480px) {
    #buttonContainer button,
    #controls label[for="mirror"],
    #controls label[for="showTimer"] {
        flex: 1 1 calc(50% - 10px);
        min-width: 100px;
    }
}


    #fontSettings {
        display: flex;
        align-items: center;
        gap: 15px;
    }

    #fontSettings label {
        margin: 0;
    }

    #controls input[type="color"] {
        width: 50px;
        height: 30px;
        padding: 0;
        margin-right: 5px;
    }

    #controls input[type="number"] {
        width: 80px;
        padding: 5px;
    }

    #controls select {
        width: auto;
        padding: 5px;
    }


    #openModalBtn {
        display: inline-block;
        padding: 10px 20px;
        background-color: #ccc;
        color: #000;
        border-radius: 5px;
        cursor: pointer;
        font-weight: bold;
        text-align: center;
        border: none;
        font-size: 14px;
        width: auto;
        max-width: 80px;
    }

    #openModalBtn:hover {
        background-color: #28a745;
        color: #fff;
    }

    #display {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        background-color: #000;
        color: #fff;
        font-size: 50px;
        display: none;
        justify-content: flex-start;
        align-items: flex-start;
    }



/* 镜像模式下的样式 */

#display.mirror {
    transform: scaleX(-1); /* 将镜像效果只应用于 #display 元素 */
}

/* 倒數計時樣式 */
#countdown {
    display: none;
    text-align: center;
    font-size: 180px;
    color: #FFA500;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%); /* 將倒數計時放置於畫面中心 */
}

/* 镜像模式下的倒数计时样式 */
#countdown.mirror  {
    transform: translate(-50%, -50%) scaleX(-1);  /* 左右翻轉倒數計時的數字 */
}


    #textContainer {
        width: 100%;
        display: block;
    }

    #text {
        width: 100%;
        text-align: center;
        white-space: pre-wrap;
        line-height: 1.5;
        direction: ltr;
    }

    #controlButtons {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        display: none;
        gap: 20px;
    }

#controlButtons button {
    padding: 10px 20px;
    font-size: 16px;
    opacity: 0.3; /* 初始狀態設為半透明 */
    transition: opacity 0.3s ease; /* 添加過渡效果，讓變化更平滑 */
}

#controlButtons button:hover {
    opacity: 1; /* 滑鼠移到按鈕上時變為完全不透明 */
}

    #referenceLine {
        position: absolute;
        top: 50%; /* 固定在畫面中間 */
        left: 0;
        width: 100%;
        border-top: 2px solid red; /* 確保這裡有適當的 border 設置 */
        pointer-events: none; /* 防止參考線阻擋點擊事件 */
    }

    .modal {
        display: none;
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
    }

    .modal-content {
        background-color: #fefefe;
        margin: 15% auto;
        padding: 20px;
        border: 1px solid #888;
        width: 80%;
        max-width: 600px;
        border-radius: 10px;
        overflow-y: auto;
        max-height: 80vh;
    }

    .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
    }

    .close:hover,
    .close:focus {
        color: #000;
        text-decoration: none;
        cursor: pointer;
    }


/* 基本计时器样式 */
#timer {
    display: none;
    position: fixed;
    top: 0px;              /* 緊貼頂部 */
    left: 50%;             /* 讓計時器的左邊緣在螢幕中間 */
    transform: translateX(-50%); /* 將計時器水平置中 */
    font-size: 48px;       /* 增加字體大小 */
    color: #FFA500;        /* 橙色 */
    background-color: rgba(0, 0, 0, 0.5);
    padding: 10px 20px;    /* 增加內部間距 */
    border-radius: 10px;   /* 調整圓角 */
    z-index: 1000;
    font-family: Arial, sans-serif;
}


</style>

</head>
<body>
<div id="controls">
    <h1 style="text-align: center; font-size: 36px; font-weight: bold; 
        background-color: #800000; /* 設定背景色 */
        color: #F5F5DC;              /* 設定文字顏色 */
        padding: 20px;             /* 增加內部間距 */
        margin: 20px 0;            /* 增加外部間距 */
        border-radius: 10px;       /* 設置圓角效果 */
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* 添加陰影效果 */
    ">
        簡易提詞器
    </h1>
    <p style="text-align: center;">
        ver.2024/10/08 <!-- 說明文件按鈕 -->
        <input type="button" id="openModalBtn" value="說明文件"><br>
        程式維護：<a href="https://www.facebook.com/profile.php?id=61557246475372" target="_blank">仨寶爸中醫博士吳啓銘</a>
    </p>

<textarea id="inputText" placeholder=">在文字框中輸入您想顯示的文字，點擊「開始滾動」按鈕即可開始提詞顯示。
>蘋果系統建議使用Safari瀏覽器開啟並隱藏工具列使用。
>安卓系統推薦將本頁安裝加入主畫面，可獲得最佳使用體驗！" oninput="this.placeholder = ''"></textarea>

<div id="buttonContainer">
    <button id="startBtn">開始滾動</button>
    <button id="clearBtn">清除暫存</button>
    <input type="checkbox" id="showTimer" checked>
    <label for="showTimer">顯示計時器</label>
    <input type="checkbox" id="mirror">
    <label for="mirror">鏡像文字</label>
</div>

        <label for="fontFamily">選擇字體：
            <select id="fontFamily">
                <option value="'Noto Sans TC', 'PingFang TC', 'Microsoft JhengHei', 'Heiti TC', 'WenQuanYi Micro Hei', sans-serif">黑體字</option>
                <option value="'Noto Serif TC', 'Songti TC', 'PMingLiU', 'Times New Roman', serif">宋體字</option>
                <option value="'BiauKai', 'STKaiti', 'KaiTi', 'DFKai-SB', 'Kai', 'KaiTi TC', 'Noto Serif TC', serif">楷體字(限電腦)</option>
                <option value="Arial, sans-serif">Arial</option>
                <option value="'Times New Roman', serif">Times New Roman</option>
                <option value="'Courier New', monospace">Courier New</option>
            </select> 
        </label>


        <label for="fontSize">字體大小：
            <input type="number" id="fontSize" value="30" min="10" max="100"> px
        </label>

        <label for="speed">滾動速度：
            <input type="number" id="speed" value="20" min="10" max="100"> px/s
        </label>

        <label for="fontColor">字體顏色：
            <input type="color" id="fontColor" value="#FFFFFF">
        </label>

        <label for="bgColor">背景顏色：
            <input type="color" id="bgColor" value="#000000">
        </label>

        <label for="refLineColor">參考線顏色：
            <input type="color" id="refLineColor" value="#FF0000">
        </label>

        <label for="refLineWidth">參考線粗細：
            <select id="refLineWidth">
                <option value="0">隱藏</option>
                <option value="1">1px</option>
                <option value="2">2px</option>
                <option value="3" selected>3px</option>
                <option value="4">4px</option>
                <option value="5">5px</option>
                <option value="6">6px</option>
                <option value="7">7px</option>
            </select>
        </label>
    </div>

<!-- 說明文件對話框 -->
<div id="myModal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <h2>說明文件</h2>
    <p>這裡是提詞機的使用說明</p>
        <ul>
            <li><strong>文字輸入：</strong>在文本框中輸入你想要提詞顯示的文字。</li>
            <li><strong>設定：</strong>可改變字體、大小、背景顏色、參考線顏色粗細等。</li>
            <li><strong>螢幕操作：</strong>按下「開始滾動」按鈕後進入全螢幕模式。</li>
            <li><strong>鏡像：</strong>如使用反射式提詞機，按下鏡像可以讓文字左右相反。</li>
            <li><strong>鍵盤操作：</strong>使用空白鍵暫停/繼續，方向鍵上下左右控制文字位置速度，ESC返回。</li>
            <li><strong>藍芽搖桿操作：</strong>連接藍芽遊戲搖桿，方向鍵上下左右控制文字位置速度，A鍵暫停/繼續，B鍵返回。</li>
        </ul>
  </div>
</div>

</div>

<div id="display">
    <div id="textContainer">
        <div id="text"></div>
    </div>

    <div id="referenceLine"></div>
<!-- 計時器 -->
<div id="timer"></div>
  <span id="timer-content"></span>
</div>

<!-- 倒數計時 -->
<div id="countdown">3</div>


<div id="controlButtons">
    <button id="pauseBtn">暫停</button>
    <button id="exitBtn">退出全屏</button>
</div>


<script>
var _0x11f341=_0x47aa;function _0x47aa(_0x20a9e4,_0x5ef270){var _0xf0cbf0=_0xf0cb();return _0x47aa=function(_0x47aaeb,_0x317830){_0x47aaeb=_0x47aaeb-0x132;var _0x249902=_0xf0cbf0[_0x47aaeb];return _0x249902;},_0x47aa(_0x20a9e4,_0x5ef270);}(function(_0x22224d,_0x3e11d5){var _0x5c9a25=_0x47aa,_0x5b20e1=_0x22224d();while(!![]){try{var _0x2fd6cc=parseInt(_0x5c9a25(0x139))/0x1*(parseInt(_0x5c9a25(0x13f))/0x2)+parseInt(_0x5c9a25(0x133))/0x3+parseInt(_0x5c9a25(0x135))/0x4*(-parseInt(_0x5c9a25(0x13e))/0x5)+-parseInt(_0x5c9a25(0x140))/0x6+-parseInt(_0x5c9a25(0x132))/0x7+-parseInt(_0x5c9a25(0x134))/0x8*(-parseInt(_0x5c9a25(0x138))/0x9)+parseInt(_0x5c9a25(0x13d))/0xa;if(_0x2fd6cc===_0x3e11d5)break;else _0x5b20e1['push'](_0x5b20e1['shift']());}catch(_0x1a7381){_0x5b20e1['push'](_0x5b20e1['shift']());}}}(_0xf0cb,0xb2d3f),eval(function(_0x555d54,_0x22d326,_0x45f200,_0x3d319e,_0x2a5e6f,_0x28eae9){var _0x3614b4=_0x47aa;_0x2a5e6f=function(_0x935fab){var _0x551ec6=_0x47aa;return(_0x935fab<_0x22d326?'':_0x2a5e6f(parseInt(_0x935fab/_0x22d326)))+((_0x935fab=_0x935fab%_0x22d326)>0x23?String[_0x551ec6(0x13b)](_0x935fab+0x1d):_0x935fab[_0x551ec6(0x136)](0x24));};if(!''[_0x3614b4(0x13a)](/^/,String)){while(_0x45f200--)_0x28eae9[_0x2a5e6f(_0x45f200)]=_0x3d319e[_0x45f200]||_0x2a5e6f(_0x45f200);_0x3d319e=[function(_0xaae4b8){return _0x28eae9[_0xaae4b8];}],_0x2a5e6f=function(){return'\x5cw+';},_0x45f200=0x1;};while(_0x45f200--)if(_0x3d319e[_0x45f200])_0x555d54=_0x555d54[_0x3614b4(0x13a)](new RegExp('\x5cb'+_0x2a5e6f(_0x45f200)+'\x5cb','g'),_0x3d319e[_0x45f200]);return _0x555d54;}('b\x20s=2.4(\x22s\x22),E=2.4(\x22E\x22),U=2.4(\x22U\x22),V=2.4(\x22V\x22),F=2.4(\x22F\x22),W=2.4(\x22W\x22),c=2.4(\x22c\x22),A=2.4(\x22A\x22),X=2.4(\x22X\x22),Y=2.4(\x22Y\x22),Z=2.4(\x22Z\x22),6=2.4(\x226\x22),1j=2.4(\x221j\x22),7=2.4(\x227\x22),G=2.4(\x22G\x22),h=2.4(\x22h\x22),11=2.4(\x2211\x22),H=2.4(\x22H\x22),l=2.4(\x2212\x22);2.9(\x221U\x22,()=>{b\x20e=13.1V(\x2214\x22);e&&(s.f=e)}),s.9(\x221W\x22,()=>{13.1X(\x2214\x22,s.f)});b\x2015=2.4(\x2215\x22);I\x20B;15.9(\x22C\x22,()=>{13.1Y(\x2214\x22),s.f=\x22\x22});I\x208=!1,j=!1,16=0,17=0,D,1k,k,m;b\x20g=2.4(\x22g\x22);I\x20x,18,19,J=0,u,v=0;a\x201l(){19=o.d(),v=0,18=1m(1n,1o)}a\x201n(){8||(J=o.d()-19-v,l.K=1p(1a.1q(J/1b)))}a\x201p(e){b\x20t=1a.1q(e/1r),n=e%1r;y`${1c(t)}:${1c(n)}`}a\x201c(e){y\x20e<10?\x220\x22+e:e}a\x20L(e){M(8||j)y\x20m=e,1Z(B=1d(L));b\x20t=e-m;m=e;b\x20n=t*D/1b;k-=n,7.3.p=`N(${k}z)`,k+7.1s>0&&(B=1d(L))}a\x201e(e){M(!8)y;j=!0,16=\x221t\x22===e.1u?e.O:e.1v[0].O;b\x20t=1w.1x(7),n=1y\x201z(t.p);17=n.1A,e.20(),2.1B.3.1C=\x22i\x22}a\x201f(e){M(!j)y;b\x20t=\x221D\x22===e.1u?e.O:e.1v[0].O,n=t-16,r=17+n;7.3.p=`N(${r}z)`}a\x201g(e){M(!j)y;j=!1;b\x20t=1w.1x(7),n=1y\x201z(t.p);k=n.1A,2.1B.3.1C=\x2221\x22}a\x201E(){b\x20e=2.22;e.1F?e.1F():e.1G?e.1G():e.1H?e.1H():e.1I&&e.1I()}a\x201h(){2.1J?2.1J():2.1K?2.1K():2.1L?2.1L():2.1M&&2.1M(),6.3.6=\x22i\x22,H.3.6=\x22i\x22,2.4(\x221N\x22).3.6=\x22P\x22,1O(B),x&&(1i(x),x=23),g.3.6=\x22i\x22,8=!1,j=!1,h.w=\x22暫停\x22,1i(18),l.3.6=\x22i\x22,J=0,v=0}a\x2024(e){k+=e,7.3.p=`N(${k}z)`}a\x2025(e){1P.1Q(\x22當前滾動速度：\x22,D=1a.26(10,D+e))}a\x2027(){8?(8=!1,h.w=\x22暫停\x22,m=Q.d(),v+=o.d()-u):(8=!0,h.w=\x22繼續\x22,u=o.d())}a\x2028(){1h(),1P.1Q(\x22退出全屏\x22)}l.3.6=\x22i\x22,A.9(\x2229\x22,()=>{A.R?l.3.6=\x22P\x22:l.3.6=\x22i\x22}),Z.9(\x22C\x22,()=>{6.3.6=\x221R\x22,H.3.6=\x221R\x22,2.4(\x221N\x22).3.6=\x22i\x22,1E(),7.3.E=E.f,7.3.F=F.f+\x22z\x22,7.3.2a=V.f,7.K=s.f,6.3.2b=U.f,G.3.2c=X.f,G.3.2d=`${Y.f}z`,g.3.6=\x22P\x22;I\x20e=5;g.K=e,c.R?g.q.S(\x22c\x22):g.q.T(\x22c\x22),x=1m(()=>{e-=1,g.K=e,c.R?(g.q.S(\x22c\x22),6.q.S(\x22c\x22),7.q.S(\x22c\x22),2.4(\x2212-1S\x22).3.p=\x221T(-1)\x22):(g.q.T(\x22c\x22),6.q.T(\x22c\x22),7.q.T(\x22c\x22),2.4(\x2212-1S\x22).3.p=\x221T(1)\x22),0===e&&(1i(x),g.3.6=\x22i\x22,A.R?l.3.6=\x22P\x22:l.3.6=\x22i\x22,8=!1,j=!1,D=2e(W.f),1l(),2f(()=>{b\x20e=6.1s,t=.5*e;k=1k=t,7.3.p=`N(${k}z)`,m=Q.d(),1d(L)},1o))},1b)}),h.9(\x22C\x22,()=>{8?(8=!1,h.w=\x22暫停\x22,m=Q.d(),v+=o.d()-u):(8=!0,h.w=\x22繼續\x22,u=o.d())}),11.9(\x22C\x22,()=>{1O(B),1h()}),6.9(\x22C\x22,()=>{j||(8?(8=!1,h.w=\x22暫停\x22,m=Q.d(),v+=o.d()-u):(8=!0,h.w=\x22繼續\x22,u=o.d()))}),7.9(\x221t\x22,1e),2.9(\x221D\x22,1f),2.9(\x222g\x22,1g),7.9(\x222h\x22,1e),2.9(\x222i\x22,1f),2.9(\x222j\x22,1g);',0x3e,0x90,_0x11f341(0x13c)[_0x11f341(0x137)]('|'),0x0,{})));function _0xf0cb(){var _0x4a7d1c=['1972932zsrVcI','30664MzAddc','1211416IaZchc','toString','split','3231hgnfeG','31ZaqHbD','replace','fromCharCode','||document|style|getElementById||display|text|isPaused|addEventListener|function|const|mirror|now||value|countdown|pauseBtn|none|isDragging|currentTranslateY|timerElement|lastTimestamp||Date|transform|classList||inputText||pauseStartTime|totalPausedTime|textContent|countdownInterval|return|px|showTimer|animationFrame|click|currentSpeed|fontFamily|fontSize|referenceLine|controlButtons|let|elapsedTime|innerText|scrollText|if|translateY|clientY|block|performance|checked|add|remove|bgColor|fontColor|speed|refLineColor|refLineWidth|startBtn||exitBtn|timer|localStorage|savedText|clearBtn|dragStartY|dragStartTranslateY|timerInterval|timerStartTime|Math|1e3|pad|requestAnimationFrame|onDragStart|onDragMove|onDragEnd|exitFullScreen|clearInterval|textContainer|startPosition|startTimer|setInterval|updateTimer|100|formatTime|floor|60|offsetHeight|mousedown|type|touches|window|getComputedStyle|new|DOMMatrixReadOnly|m42|body|userSelect|mousemove|enterFullScreen|requestFullscreen|mozRequestFullScreen|webkitRequestFullscreen|msRequestFullscreen|exitFullscreen|mozCancelFullScreen|webkitExitFullscreen|msExitFullscreen|controls|cancelAnimationFrame|console|log|flex|content|scaleX|DOMContentLoaded|getItem|input|setItem|removeItem|void|preventDefault|auto|documentElement|null|scrollTextBy|changeSpeedBy|max|togglePause|exitTeleprompter|change|color|backgroundColor|borderTopColor|borderTopWidth|parseInt|setTimeout|mouseup|touchstart|touchmove|touchend','1480450RBMBgd','20wqzbXC','73140EaYbeZ','6533280kaiymO','1978417MgNUYH'];_0xf0cb=function(){return _0x4a7d1c;};return _0xf0cb();}
// 處理鍵盤事件
document.addEventListener('keydown', (event) => {
    switch (event.code) {
        case 'Space':
            togglePause();  // 暫停或繼續滾動
            break;
        case 'ArrowUp':
        case 'PageUp':
            scrollTextBy(10);  // 向上滾動
            break;
        case 'ArrowDown':
        case 'PageDown':
            scrollTextBy(-10);  // 向下滾動
            break;
        case 'ArrowLeft':
            changeSpeedBy(-10);  // 減少滾動速度
            break;
        case 'ArrowRight':
            changeSpeedBy(10);  // 增加滾動速度
            break;
        case 'Escape':
            exitTeleprompter();  // 退出全屏
            break;
        default:
            break;
    }
});

let currentGamepad = null;
let wasButtonAPressed = false;  // 記錄A鍵狀態
let lastSpeedChangeTime = 0;     // 記錄速度變更的時間
const speedChangeCooldown = 200; // 速度變更的冷卻時間

// 檢查搖桿連接狀態
window.addEventListener("gamepadconnected", (event) => {
    console.log("Gamepad connected:", event.gamepad);
    currentGamepad = event.gamepad;
    requestAnimationFrame(checkGamepadInput);  // 開始檢查搖桿輸入
});

window.addEventListener("gamepaddisconnected", (event) => {
    console.log("Gamepad disconnected:", event.gamepad);
    if (currentGamepad && event.gamepad.index === currentGamepad.index) {
        currentGamepad = null;  // 重置當前搖桿
    }
});

// 持續檢查遊戲控制器的輸入
function checkGamepadInput() {
    if (currentGamepad) {
        const gamepads = navigator.getGamepads();
        const gp = gamepads[currentGamepad.index];

        if (gp) {
            const now = Date.now();

            // D-pad 上下鍵控制滾動
            const dpadUp = gp.buttons[12].pressed;
            const dpadDown = gp.buttons[13].pressed;

            if (dpadUp) {
                scrollTextBy(10);  // D-pad 向上滾動
                console.log('D-pad 向上滾動，當前位置：', currentTranslateY);
            } else if (dpadDown) {
                scrollTextBy(-10);  // D-pad 向下滾動
                console.log('D-pad 向下滾動，當前位置：', currentTranslateY);
            }

            // R 和 L 鍵控制快速滾動
            const rButton = gp.buttons[5].pressed;
            const lButton = gp.buttons[4].pressed;

            if (rButton) {
                scrollTextBy(20);  // R 鍵快速向上滾動
                console.log('R鍵快速向上滾動');
            } else if (lButton) {
                scrollTextBy(-20);  // L 鍵快速向下滾動
                console.log('L鍵快速向下滾動');
            }

            // D-pad 左右鍵控制滾動速度，並加入冷卻機制
            const dpadLeft = gp.buttons[14].pressed;
            const dpadRight = gp.buttons[15].pressed;

            if (now - lastSpeedChangeTime > speedChangeCooldown) {
                if (dpadLeft) {
                    changeSpeedBy(-10);  // 減少滾動速度
                    console.log('減少滾動速度');
                    lastSpeedChangeTime = now;
                } else if (dpadRight) {
                    changeSpeedBy(10);  // 增加滾動速度
                    console.log('增加滾動速度');
                    lastSpeedChangeTime = now;
                }
            }

            // A 鍵暫停/繼續滾動
            const isButtonAPressed = gp.buttons[0].pressed;
            if (isButtonAPressed && !wasButtonAPressed) {
                togglePause();  // A 鍵觸發暫停
                console.log('A鍵被按下，切換暫停狀態');
            }
            wasButtonAPressed = isButtonAPressed;  // 更新按鍵狀態

            // B 鍵退出全屏
            if (gp.buttons[1].pressed) {
                exitTeleprompter();  // B 鍵退出全屏
            }
        }
    }

    // 繼續檢查遊戲控制器輸入
    if (currentGamepad) {
        requestAnimationFrame(checkGamepadInput);
    }
}


// 說明對話框設定
var modal = document.getElementById("myModal");
var btn = document.getElementById("openModalBtn");
var span = document.getElementsByClassName("close")[0];
btn.onclick = function() {
    modal.style.display = "block";
}
span.onclick = function() {
    modal.style.display = "none";
}
window.onclick = function(event) {
    if (event.target == modal) {
        modal.style.display = "none";
    }
}

// 避免螢幕變暗
let wakeLock = null;

// 尝试使用 Wake Lock API，如果支持
async function requestWakeLock() {
  if ('wakeLock' in navigator) {
    try {
      wakeLock = await navigator.wakeLock.request('screen');
      console.log('Wake Lock is active');
      
      wakeLock.addEventListener('release', () => {
        console.log('Wake Lock was released');
      });
    } catch (err) {
      console.error(`${err.name}, ${err.message}`);
    }
  } else {
    console.warn('Wake Lock API not supported on this browser.');
  }
}

// 定时触发页面的微小变化和滚动事件以防止屏幕变暗
function preventScreenDim() {
  setInterval(() => {
    // 模拟轻微的滚动
    if (window.pageYOffset === 0) {
      window.scrollBy(0, 1); // 向下滚动1像素
      window.scrollBy(0, -1); // 向上滚动1像素
    }

    // 改变页面某个元素的透明度，触发视觉更新
    const body = document.body;
    body.style.opacity = body.style.opacity === '0.99' ? '1' : '0.99'; // 微调透明度
  }, 10000); // 每10秒触发一次
}


// 在按钮点击时触发所有防止屏幕变暗的机制
document.getElementById('startBtn').addEventListener('click', () => {
  requestWakeLock();          // 尝试使用 Wake Lock API
  preventScreenDim();         // 开始定时触发用户交互

});



</script>

</body>
</html>
